<!DOCTYPE html>
<html>
<!-- Head information -->
<head>
<meta charset='utf-8'>
<meta content='width=device-width' initial-scale='1' name='viewport'>
<!-- Always force latest IE rendering engine or request Chrome Frame -->
<!-- %meta{content: 'IE=edge,chrome=1', http-equiv: 'X-UA-Compatible'} -->
<link href='/assets/images/favicon/favicon-196x196.png' rel='icon' sizes='196x196' type='image/png'>
<link href='/assets/images/favicon/favicon-32x32.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/assets/images/favicon/favicon-16x16.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/assets/images/favicon/favicon-128.png' rel='icon' sizes='128x128' type='image/png'>
<link href='/assets/images/favicon/favicon.ico' rel='icon'>
<!-- Use title if it's in the page YAML frontmatter -->
<title>
Kubeless
</title>
<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css' media='screen' rel='stylesheet'>
<!-- Bitnami Design System -->
<link href='https://fonts.googleapis.com/css?family=Fira+Sans:300,400,700|Hind:300,400' media='screen' rel='stylesheet'>
<link href='//d1d5nb8vlsbujg.cloudfront.net/bitnami-ui/2.0.1/bitnami.ui.components.min.css' media='screen' rel='stylesheet'>
<link href='//d1d5nb8vlsbujg.cloudfront.net/bitnami-ui/2.0.1/bitnami.ui.min.css' media='screen' rel='stylesheet'>
<!-- Include the javascripts and the styles of the page -->
<link href="/assets/stylesheets/main.css" rel="stylesheet" />
<script src="/assets/javascripts/main.js"></script>
</head>

<!-- Main content -->
<body>
<div class='gradient-135-accent elevation-1'>
<div class='container'>
<header class='Header padding-v-big'>
<div class='row collapse-b-tablet align-center'>
<div class='col-4'>
<div class='Header__Logo'>
<a href="/"><img src="/assets/images/logo-white.svg" alt="Logo white" />
<span>
A Bitnami project
</span>
</a></div>
</div>
<div class='col-8'>
<nav class='text-r'>
<a href="/" class="margin-h-normal">Home</a>
<a href="/docs" class="margin-h-normal">Documentation</a>
<a href="https://github.com/kubeless/kubeless-ui" class="margin-h-normal">Kubeless UI</a>
<a href="https://serverless.com/framework/docs/providers/kubeless/guide/intro/" class="margin-h-normal">Serverless Plugin</a>
<a href="https://github.com/kubeless" class="margin-l-normal">GitHub</a>
</nav>
</div>
</div>
</header>

</div>
</div>
<main class='container margin-t-big'>
<div class='row collapse-b-phone-land'>
<div class='col-3'>
<h4 class='margin-t-bigger'>
<img src="/assets/images/logo-dark.svg" alt="Kubeless logo" class="float-l avatar avatar-medium" />
<div class='padding-v-small'>
Documentation
</div>
</h4>
<ul class='remove-style padding-small'>
<li>
<b>Usage</b>
</li>
<li class='margin-v-small'>
<a href="/docs/quick-start">Quick Start
</a></li>
<li class='margin-v-small'>
<a href="/docs/runtimes">Runtimes
</a></li>
<li class='margin-v-small'>
<a href="/docs/kubeless-functions">Function Characteristics
</a></li>
<li class='margin-v-small'>
<a href="/docs/triggers">Triggers
</a></li>
<li class='margin-v-small'>
<a href="/docs/pubsub-functions">PubSub Mechanism
</a></li>
<li class='margin-v-small'>
<a href="/docs/http-triggers">Expose and Secure Functions
</a></li>
<li class='margin-v-small'>
<a href="/docs/cronjob-triggers">Scheduling a function execution (CronJob)
</a></li>
<li class='margin-v-small'>
<a href="/docs/streaming-functions">Data Stream Events
</a></li>
<li class='margin-v-small'>
<a href="/docs/debug-functions">Debug Functions
</a></li>
<li class='margin-v-small'>
<a href="/docs/autoscaling">Autoscaling
</a></li>
<li class='margin-v-small'>
<a href="/docs/building-functions">Build Function Images
</a></li>
<li class='margin-v-small'>
<a href="/docs/monitoring">Monitoring
</a></li>
<li class='margin-v-small'>
<a href="/docs/advanced-function-deployment">Advanced deployment
</a></li>
<li class='margin-v-small'>
<a href="/docs/function-controller-configuration">Kubeless Configuration
</a></li>
<li class='margin-v-small'>
<a href="/docs/use-existing-kafka">Use a Custom Apache Kafka
</a></li>
<li class='margin-v-small'>
<a href="/docs/troubleshooting">Install Troubleshooting
</a></li>
<li class='padding-t-big'>
<b>Cloud Providers</b>
</li>
<li class='margin-v-small'>
<a href="/docs/kubeless-on-AKS">Azure Kubernetes Service
</a></li>
<li class='margin-v-small'>
<a href="/docs/GKE-deployment">Google Kubernetes Engine
</a></li>
<li class='padding-t-big'>
<b>Development</b>
</li>
<li class='margin-v-small'>
<a href="/docs/architecture">Architecture
</a></li>
<li class='margin-v-small'>
<a href="/docs/dev-guide">Development Guide
</a></li>
<li class='margin-v-small'>
<a href="/docs/implementing-new-runtime">Implementing a New Runtime
</a></li>
<li class='margin-v-small'>
<a href="/docs/implementing-new-trigger">Implementing a New Trigger
</a></li>
<li class='margin-v-small'>
<a href="/docs/debugging">Debugging
</a></li>
<li class='margin-v-small'>
<a href="/docs/release-flow">Release Flow
</a></li>
</ul>

</div>
<div class='col-9'>
<h1 id="pubsub-events">PubSub events</h1>

<p>You can trigger any Kubeless function by a PubSub mechanism. The PubSub function is expected to consume input messages from a predefined topic from a messaging system. Kubeless currently supports using events from Kafka and NATS messaging systems.</p>

<h2 id="kafka">Kafka</h2>

<p>In Kafka <a href="https://github.com/kubeless/kafka-trigger/releases">release page</a>, you can find the manifest to quickly deploy a collection of Kafka and Zookeeper statefulsets. If you have a Kafka cluster already running in the same Kubernetes environment, you can also deploy PubSub function with it. Check out <a href="/docs/use-existing-kafka">this tutorial</a> for more details how to do that.</p>

<p>If you want to deploy the manifest we provide to deploy Kafka and Zookeeper execute the following command:</p>

<pre><code class="console">$ export RELEASE=$(curl -s https://api.github.com/repos/kubeless/kafka-trigger/releases/latest | grep tag_name | cut -d &#39;&quot;&#39; -f 4)
$ kubectl create -f https://github.com/kubeless/kafka-trigger/releases/download/$RELEASE/kafka-zookeeper-$RELEASE.yaml
</code></pre>

<blockquote>
<p>NOTE: Kafka statefulset uses a PVC (persistent volume claim). Depending on the configuration of your cluster you may need to provision a PV (Persistent Volume) that matches the PVC or configure dynamic storage provisioning. Otherwise Kafka pod will fail to get scheduled. Also note that Kafka is only required for PubSub functions, you can still use http triggered functions. Please refer to <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">PV</a> documentation on how to provision storage for PVC.</p>
</blockquote>

<p>Once deployed, you can verify two statefulsets up and running:</p>

<pre><code>$ kubectl -n kubeless get statefulset
NAME      DESIRED   CURRENT   AGE
kafka     1         1         40s
zoo       1         1         42s

$ kubectl -n kubeless get svc
NAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE
broker      ClusterIP   None            &lt;none&gt;        9092/TCP            1m
kafka       ClusterIP   10.55.250.89    &lt;none&gt;        9092/TCP            1m
zoo         ClusterIP   None            &lt;none&gt;        9092/TCP,3888/TCP   1m
zookeeper   ClusterIP   10.55.249.102   &lt;none&gt;        2181/TCP            1m
</code></pre>

<p>A function can be as simple as:</p>

<pre><code class="python">def foobar(event, context):
  print event[&#39;data&#39;]
  return event[&#39;data&#39;]
</code></pre>

<p>Now you can deploy a pubsub function. </p>

<pre><code class="console">$ kubeless function deploy test --runtime python2.7 \
                                --handler test.foobar \
                                --from-file test.py
</code></pre>

<p>You need to create a <em>Kafka</em> trigger that lets you associate a function with a topic specified by <code>--trigger-topic</code> as below:</p>

<pre><code class="console">$ kubeless trigger kafka create test --function-selector created-by=kubeless,function=test --trigger-topic test-topic
</code></pre>

<p>After that you can invoke the function by publishing messages in that topic. To allow you to easily manage topics <code>kubeless</code> provides a convenience function <code>kubeless topic</code>. You can create/delete and publish to a topic easily.</p>

<pre><code class="console">$ kubeless topic create test-topic
$ kubeless topic publish --topic test-topic --data &quot;Hello World!&quot;
</code></pre>

<p>You can check the result in the pod logs:</p>

<pre><code class="console">$ kubectl logs test-695251588-cxwmc
...
Hello World!
</code></pre>

<h2 id="nats">NATS</h2>

<p>If you do not have NATS cluster its pretty easy to setup a NATS cluster. Run below command to deploy a <a href="https://github.com/nats-io/nats-operator">NATS operator</a></p>

<pre><code class="console">$ kubectl apply -f https://raw.githubusercontent.com/nats-io/nats-operator/master/example/deployment-rbac.yaml
</code></pre>

<p>Once NATS operator is up and running run below command to deploy a NATS cluster</p>

<pre><code class="console">echo &#39;
apiVersion: &quot;nats.io/v1alpha2&quot;
kind: &quot;NatsCluster&quot;
metadata:
  name: &quot;nats&quot;
spec:
  size: 3
  version: &quot;1.1.0&quot;
&#39; | kubectl apply -f - -n nats-io
</code></pre>

<p>Above command will create NATS cluster IP service <code>nats.nats-io.svc.cluster.local:4222</code> which is the default URL Kubeless NATS trigger contoller expects.</p>

<p>Now use this manifest to deploy Kubeless NATS triggers controller.</p>

<pre><code class="console">$ export RELEASE=$(curl -s https://api.github.com/repos/kubeless/nats-trigger/releases/latest | grep tag_name | cut -d &#39;&quot;&#39; -f 4)
$ kubectl create -f https://github.com/kubeless/nats-trigger/releases/download/$RELEASE/nats-$RELEASE.yaml
</code></pre>

<p>By default NATS trigger controller expects NATS cluster is available as Kubernetes cluster service <code>nats.nats-io.svc.cluster.local:4222</code>. You can overide the default NATS cluster url used by setting the environment variable <code>NATS_URL</code> in the manifest. Once NATS trigger controller is setup you can deploy the function and associate function with a topic on the NATS cluster.</p>

<pre><code class="console">$ kubeless function deploy pubsub-python-nats --runtime python2.7 \
                                --handler test.foobar \
                                --from-file test.py
</code></pre>

<p>After function is deployed you can use <code>kubeless trigger nats</code> CLI command to  associate function with a topic on NATS cluster as below.</p>

<pre><code class="console">$ kubeless trigger nats create pubsub-python-nats --function-selector created-by=kubeless,function=pubsub-python-nats --trigger-topic test
</code></pre>

<p>At this point you are all set try Kubeless NATS triggers.</p>

<p>You could quickly test the functionality by publishing a message to the topic, and verifying that message is seen by the pod running the function.</p>

<pre><code class="console">$ kubeless trigger nats publish --url nats://nats-server-ip:4222 --topic test --message &quot;Hello World!&quot;
</code></pre>

<p>You can check the result in the pod logs:</p>

<pre><code class="console">$ kubectl logs pubsub-python-nats-5b9c849fc-tvq2l
...
Hello World!
</code></pre>

<h2 id="other-commands">Other commands</h2>

<p>You can create, list and delete PubSub topics (for Kafka):</p>

<pre><code class="console">$ kubeless topic create another-topic
Created topic &quot;another-topic&quot;.

$ kubeless topic delete another-topic

$ kubeless topic ls
</code></pre>

</div>
</div>
</main>
<div class='margin-t-giant'>
<div class='Footer'>
<div class='container padding-h-big padding-v-bigger'>
<div class='Footer__Border padding-t-big'>
<div class='row collapse-b-phone-land'>
<div class='col-6'>
<h4 class='inverse margin-reset'>
<img src="/assets/images/logo-white.svg" alt="Kubeless logo" class="Footer__Logo" />
</h4>
<p class='type-color-iron type-small margin-reset'>
© Kubeless 2021 | All Rights Reserved.
</p>
</div>
<div class='col-6 text-r'>
<a href="https://github.com/kubeless" class="margin-l-small"><img src="/assets/images/social/github.svg" alt="See the Github Profile of the Kubeless project" />
</a></div>
</div>
</div>
</div>
</div>

</div>
</body>
</html>
<script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js'></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
